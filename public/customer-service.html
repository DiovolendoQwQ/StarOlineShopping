<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>客服咨询</title>
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    .cs-container{max-width:880px;margin:48px auto;padding:0;border-radius:16px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,.12);background:#fff}
    .cs-header{display:flex;justify-content:space-between;align-items:center;padding:18px 24px;background:linear-gradient(135deg,#ff7a18,#ff3c00);color:#fff}
    .cs-title{font-size:18px;font-weight:600;letter-spacing:.5px}
    .cs-status{font-size:12px;opacity:.9}
    .cs-status .dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px;background:#22c55e}
    .cs-status.offline .dot{background:#ef4444}
    .cs-body{padding:16px 16px 12px;background:linear-gradient(180deg,#f7f8fc 0%,#ffffff 100%)}
    .cs-chat{height:420px;overflow:auto;border:1px solid #eee;border-radius:12px;padding:16px;background:#f9fafb}
    .cs-msg-row{display:flex;align-items:flex-end;margin:10px 0}
    .cs-msg-row.me{justify-content:flex-end}
    .cs-avatar{width:32px;height:32px;border-radius:50%;background:#fde68a;flex:0 0 32px;display:flex;align-items:center;justify-content:center;color:#b45309;font-weight:700}
    .cs-avatar.srv{background:#bfdbfe;color:#1d4ed8}
    .cs-bubble{max-width:68%;padding:10px 12px;border-radius:14px;position:relative;font-size:14px;line-height:1.6;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .cs-bubble.me{background:#e8f5e9;color:#1b5e20;border-top-right-radius:4px}
    .cs-bubble.srv{background:#e3f2fd;color:#0b3b7a;border-top-left-radius:4px}
    .cs-time{font-size:11px;color:#999;margin-top:4px}
    .cs-form{display:flex;gap:10px;margin-top:14px}
    .cs-form input{flex:1;padding:12px 14px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;outline:none;transition:all .2s}
    .cs-form input:focus{box-shadow:0 0 0 3px rgba(99,102,241,.15);border-color:#6366f1}
    .cs-form button{padding:12px 18px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;letter-spacing:.3px;transition:transform .1s ease}
    .cs-form button:active{transform:scale(.98)}
    .cs-form button:disabled{opacity:.6;cursor:not-allowed}
    .cs-toast{position:fixed;left:50%;bottom:28px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 16px;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.2);opacity:0;visibility:hidden;transition:all .25s}
    .cs-toast.show{opacity:1;visibility:visible}

    @media (max-width: 768px){
      .cs-container{max-width:100%;margin:0;padding:0;border-radius:0;box-shadow:none}
      .cs-header{padding:14px 16px}
      .cs-title{font-size:16px}
      .cs-body{padding:12px}
      .cs-chat{height:60vh}
      .cs-form{flex-direction:column}
      .cs-form button{width:100%}
    }
  </style>
  <script src="/js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const statusEl = document.getElementById('cs-status');
      const chatEl = document.getElementById('cs-chat');
      const inputEl = document.getElementById('cs-input');
      const sendBtn = document.getElementById('cs-send');
      const toastEl = document.getElementById('cs-toast');
      function fmtTime(){return new Date().toLocaleTimeString('zh-CN',{hour12:false,hour:'2-digit',minute:'2-digit'});}      
      function showToast(text){toastEl.textContent=text;toastEl.classList.add('show');setTimeout(()=>{toastEl.classList.remove('show');},2000);}      
      function addMsg(text, who){
        const row=document.createElement('div');
        row.className='cs-msg-row '+(who==='me'?'me':'srv');
        const avatar=document.createElement('div');
        avatar.className='cs-avatar '+(who==='me'?'me':'srv');
        avatar.textContent=who==='me'?'我':'客';
        const bubble=document.createElement('div');
        bubble.className='cs-bubble '+(who==='me'?'me':'srv');
        bubble.innerHTML=`<div>${text}</div><div class="cs-time">${fmtTime()}</div>`;
        if(who==='me'){row.appendChild(bubble);row.appendChild(avatar);}else{row.appendChild(avatar);row.appendChild(bubble);}        
        chatEl.appendChild(row);
        chatEl.scrollTop=chatEl.scrollHeight;
      }
      document.addEventListener('cs:status', function(ev){
        const { connected } = ev.detail || {};
        statusEl.classList.toggle('offline', !connected);
        statusEl.innerHTML = `${connected?'<span class="dot"></span>已连接':'<span class="dot"></span>未连接，自动重试中...'}`;
        sendBtn.disabled = false;
      });
      document.addEventListener('cs:message', function(ev){
        const msg = ev.detail || {};
        if (msg.type === 'reply'){ addMsg(msg.message || '客服回复', 'srv'); }
        if (msg.type === 'ack'){ showToast('已收到，我们会尽快回复'); }
      });
      function doSend(){
        const text=(inputEl.value||'').trim();
        if(!text) return;
        addMsg(text,'me');
        inputEl.value='';
        window.CustomerService.sendQuestion(text);
      }
      sendBtn.addEventListener('click', doSend);
      inputEl.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); doSend(); } });
    });
  </script>
  </head>
<body>
  <div class="cs-container">
    <div class="cs-header">
      <div class="cs-title">客服咨询</div>
      <div class="cs-status"><span class="dot"></span><span id="cs-status">连接中...</span></div>
    </div>
    <div class="cs-body">
      <div style="margin-bottom:8px;font-size:12px;color:#6b7280">会话ID：<span id="cs-session"></span></div>
      <div class="cs-chat" id="cs-chat"></div>
      <div class="cs-form">
        <input id="cs-input" type="text" placeholder="请输入您的问题，比如“我想退货”" />
        <button id="cs-send" type="button">发送</button>
      </div>
      <div style="margin-top:10px;font-size:12px;color:#9ca3af">按 Enter 可快速发送</div>
      <div style="margin-top:12px">
        <a href="/login.html">返回登录</a> ｜ <a href="/homepage">返回首页</a>
      </div>
    </div>
  </div>
  <div class="cs-toast" id="cs-toast"></div>
  <script>
    document.getElementById('cs-session').textContent = window.CustomerService.sessionId();
  </script>
</body>
</html>
