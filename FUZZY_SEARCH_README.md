# 模糊搜索功能说明

## 功能概述

本项目新增了强大的模糊搜索功能，提供更智能、更人性化的商品搜索体验。

## 主要特性

### 🔍 智能模糊匹配
- **多关键词搜索**: 支持空格分隔的多个关键词
- **相关性评分**: 基于算法计算商品与搜索词的匹配度
- **编辑距离算法**: 支持拼写错误容错
- **权重系统**: 商品名称匹配权重高于描述匹配

### 🔤 拼音搜索支持
- 支持拼音全拼搜索（如：`shouji` → `手机`）
- 支持拼音简拼搜索（如：`sj` → `手机`）
- 内置常用商品拼音映射表

### 📝 同义词识别
- 智能识别商品同义词
- 例如：`电话` = `手机` = `移动电话` = `智能机`
- 扩展搜索范围，提高搜索召回率

### 💡 实时搜索建议
- 输入2个字符后自动显示搜索建议
- 基于商品名称智能生成建议词
- 支持键盘导航选择建议

### 🔥 热门搜索词
- 搜索框获得焦点时显示热门搜索词
- 一键快速搜索热门商品
- 提升用户搜索体验

### ⌨️ 键盘导航
- `↑/↓` 键导航搜索建议和结果
- `Enter` 键选择当前项
- `Esc` 键关闭搜索面板

## 技术实现

### 后端架构

#### 搜索服务 (`services/searchService.js`)
- **模糊搜索算法**: 基于编辑距离和权重评分
- **拼音映射**: 内置拼音-汉字映射表
- **同义词处理**: 智能同义词扩展
- **相关性计算**: 多维度评分系统

#### API 端点
```javascript
// 模糊搜索
GET /products/api/search?q=关键词&limit=20&offset=0

// 搜索建议
GET /products/api/suggestions?q=关键词&limit=5

// 热门搜索词
GET /products/api/hot-searches?limit=10
```

### 前端实现

#### 搜索管理器 (`public/js/search.js`)
- **实时搜索**: 300ms 防抖延迟
- **多容器管理**: 搜索结果、建议、热门搜索
- **键盘导航**: 完整的键盘交互支持
- **视觉反馈**: 高亮匹配文本、相关性得分显示

## 使用方法

### 基本搜索
1. 在搜索框输入关键词
2. 系统自动显示搜索建议
3. 选择建议或直接搜索
4. 查看按相关性排序的结果

### 高级搜索技巧
- **多关键词**: `小米 手机` 搜索包含两个词的商品
- **拼音搜索**: `shouji` 搜索手机相关商品
- **模糊匹配**: `shuji` 也能找到手机（容错1-2个字符）

### 搜索结果说明
- **匹配度标签**: 显示商品与搜索词的相关性百分比
- **高亮显示**: 搜索词在结果中会被高亮标记
- **智能排序**: 按相关性得分从高到低排列

## 配置选项

### 搜索参数
```javascript
// 搜索选项
const options = {
  limit: 50,        // 结果数量限制
  offset: 0,        // 分页偏移
  minScore: 0.1     // 最小相关性得分
};
```

### 自定义映射
可以在 `searchService.js` 中扩展：
- `pinyinMap`: 添加更多拼音映射
- `synonymMap`: 添加更多同义词

## 性能优化

### 前端优化
- **防抖处理**: 避免频繁API调用
- **结果缓存**: 相同搜索词复用结果
- **懒加载**: 按需加载搜索结果

### 后端优化
- **算法优化**: 高效的编辑距离计算
- **内存缓存**: 热门搜索词缓存
- **数据库索引**: 商品名称和描述字段索引

## 扩展建议

### 未来改进方向
1. **搜索日志**: 记录用户搜索行为，优化热门词
2. **机器学习**: 基于用户行为优化相关性算法
3. **全文搜索**: 集成 Elasticsearch 提升搜索性能
4. **图片搜索**: 支持以图搜图功能
5. **语音搜索**: 集成语音识别API

### 数据分析
- 搜索词频统计
- 搜索转化率分析
- 用户搜索路径分析

## 故障排除

### 常见问题

**Q: 搜索建议不显示？**
A: 检查API端点是否正常，确保输入至少2个字符

**Q: 拼音搜索不工作？**
A: 确认拼音映射表中包含对应词汇，可手动添加

**Q: 搜索结果相关性不准确？**
A: 调整权重系统参数，优化评分算法

### 调试模式
```javascript
// 启用调试日志
console.log('搜索词处理结果:', searchTerms);
console.log('相关性得分:', relevanceScore);
```

## 更新日志

### v1.0.0 (当前版本)
- ✅ 基础模糊搜索功能
- ✅ 拼音搜索支持
- ✅ 实时搜索建议
- ✅ 热门搜索词
- ✅ 键盘导航
- ✅ 相关性评分
- ✅ 同义词识别

---

**开发者**: AI Assistant  
**更新时间**: 2024年12月  
**技术栈**: Node.js + Express + SQLite + Vanilla JavaScript