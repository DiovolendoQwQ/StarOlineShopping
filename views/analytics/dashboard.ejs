<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - STARË¥≠Áâ©Âπ≥Âè∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .recommendation-item {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 15px;
        }
        .priority-high {
            border-left-color: #dc3545;
        }
        .priority-medium {
            border-left-color: #ffc107;
        }
        .priority-low {
            border-left-color: #28a745;
        }
        .sidebar {
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px 0;
        }
        .nav-link {
            color: #495057;
            border-radius: 8px;
            margin: 2px 0;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- ‰æßËæπÊ†è -->
            <div class="col-md-2 sidebar">
                <h5 class="text-center mb-4">Êï∞ÊçÆÂàÜÊûê</h5>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#overview" data-section="overview">
                        <i class="fas fa-chart-line me-2"></i>Ê¶ÇËßà
                    </a>
                    <a class="nav-link" href="#user-behavior" data-section="user-behavior">
                        <i class="fas fa-users me-2"></i>Áî®Êà∑Ë°å‰∏∫
                    </a>
                    <a class="nav-link" href="#product-performance" data-section="product-performance">
                        <i class="fas fa-box me-2"></i>‰∫ßÂìÅÊÄßËÉΩ
                    </a>
                    <a class="nav-link" href="#trends" data-section="trends">
                        <i class="fas fa-chart-area me-2"></i>Ë∂ãÂäøÂàÜÊûê
                    </a>
                    <a class="nav-link" href="#recommendations" data-section="recommendations">
                        <i class="fas fa-lightbulb me-2"></i>Êô∫ËÉΩÂª∫ËÆÆ
                    </a>
                </nav>
                <div class="mt-4">
                    <a href="/homepage" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-home me-1"></i>ËøîÂõûÈ¶ñÈ°µ
                    </a>
                </div>
            </div>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <div class="col-md-10">
                <div class="container-fluid py-4">
                    <!-- È°µÈù¢Ê†áÈ¢ò -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2><i class="fas fa-chart-dashboard me-2"></i><%= title %></h2>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" data-days="7">7Â§©</button>
                            <button type="button" class="btn btn-outline-primary active" data-days="30">30Â§©</button>
                            <button type="button" class="btn btn-outline-primary" data-days="90">90Â§©</button>
                        </div>
                    </div>

                    <!-- Ê¶ÇËßàÈÉ®ÂàÜ -->
                    <div id="overview" class="section">
                        <!-- ‰∏ªË¶ÅÊåáÊ†áÂç°Áâá -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card dashboard-card metric-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-users fa-2x mb-2"></i>
                                        <h3 id="total-users"><%= report.summary.total_users || 0 %></h3>
                                        <p class="mb-0">ÊÄªÁî®Êà∑Êï∞</p>
                                        <small class="text-light" id="user-growth">Â¢ûÈïøÁéá: <%= report.summary.user_growth_rate || 0 %>%</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card metric-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x mb-2"></i>
                                        <h3 id="daily-active-users"><%= report.summary.daily_active_users || 0 %></h3>
                                        <p class="mb-0">Êó•Ê¥ªË∑ÉÁî®Êà∑</p>
                                        <small class="text-light">‰ªäÊó•Ê¥ªË∑É</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card metric-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                                        <h3 id="total-orders"><%= report.summary.total_orders || 0 %></h3>
                                        <p class="mb-0">ÊÄªËÆ¢ÂçïÊï∞</p>
                                        <small class="text-light">¬•<span id="avg-order-value"><%= (report.summary.avg_order_value || 0).toFixed(2) %></span> Âπ≥ÂùáËÆ¢Âçï</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card metric-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-dollar-sign fa-2x mb-2"></i>
                                        <h3 id="total-revenue">¬•<%= (report.summary.total_revenue || 0).toFixed(2) %></h3>
                                        <p class="mb-0">ÊÄªÊî∂ÂÖ•</p>
                                        <small class="text-light">Á¥ØËÆ°Êî∂ÂÖ•</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ê¨°Ë¶ÅÊåáÊ†áÂç°Áâá -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-eye fa-2x mb-2 text-info"></i>
                                        <h4 id="total-views">0</h4>
                                        <p class="mb-0 text-muted">ÊÄªÊµèËßàÈáè</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-percentage fa-2x mb-2 text-success"></i>
                                        <h4 id="conversion-rate"><%= report.summary.conversion_rates?.viewToPurchase || 0 %>%</h4>
                                        <p class="mb-0 text-muted">ËΩ¨ÂåñÁéá</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-clock fa-2x mb-2 text-warning"></i>
                                        <h4 id="avg-session-duration">0</h4>
                                        <p class="mb-0 text-muted">Âπ≥Âùá‰ºöËØùÊó∂Èïø(ÂàÜÈíü)</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-bounce fa-2x mb-2 text-danger"></i>
                                        <h4 id="bounce-rate">0%</h4>
                                        <p class="mb-0 text-muted">Ë∑≥Âá∫Áéá</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Êî∂ÂÖ•Ë∂ãÂäøÂõæ -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-chart-area me-2"></i>Êî∂ÂÖ•Ë∂ãÂäø</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="revenueChart" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Áî®Êà∑Ë°å‰∏∫ÂàÜÊûê -->
                    <div id="user-behavior" class="section" style="display: none;">
                        <!-- Áî®Êà∑Ë°å‰∏∫Ê¶ÇËßà -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-mouse-pointer fa-2x mb-2 text-primary"></i>
                                        <h4 id="total-clicks">0</h4>
                                        <p class="mb-0 text-muted">ÊÄªÁÇπÂáªÊï∞</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-shopping-basket fa-2x mb-2 text-warning"></i>
                                        <h4 id="cart-additions">0</h4>
                                        <p class="mb-0 text-muted">Âä†Ë¥≠Ê¨°Êï∞</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-heart fa-2x mb-2 text-danger"></i>
                                        <h4 id="wishlist-additions">0</h4>
                                        <p class="mb-0 text-muted">Êî∂ËóèÊ¨°Êï∞</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-share fa-2x mb-2 text-info"></i>
                                        <h4 id="shares">0</h4>
                                        <p class="mb-0 text-muted">ÂàÜ‰∫´Ê¨°Êï∞</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÂõæË°®Âå∫Âüü -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-chart-pie me-2"></i>Ë°å‰∏∫Á±ªÂûãÂàÜÂ∏É</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="behaviorChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-funnel-dollar me-2"></i>ËΩ¨ÂåñÊºèÊñó</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="conversionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏É -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-clock me-2"></i>Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏É</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="hourlyActivityChart" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Áî®Êà∑Ë∑ØÂæÑÂàÜÊûê -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-route me-2"></i>ÁÉ≠Èó®Áî®Êà∑Ë∑ØÂæÑ</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="user-paths-list">
                                            <!-- Âä®ÊÄÅÂä†ËΩΩÁî®Êà∑Ë∑ØÂæÑÊï∞ÊçÆ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-users me-2"></i>Áî®Êà∑ÁªÜÂàÜ</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="userSegmentChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‰∫ßÂìÅÊÄßËÉΩÂàÜÊûê -->
                    <div id="product-performance" class="section" style="display: none;">
                        <!-- ‰∫ßÂìÅÊ¶ÇËßàÊåáÊ†á -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-box fa-2x mb-2 text-primary"></i>
                                        <h4 id="total-products">0</h4>
                                        <p class="mb-0 text-muted">ÊÄª‰∫ßÂìÅÊï∞</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-fire fa-2x mb-2 text-danger"></i>
                                        <h4 id="hot-products">0</h4>
                                        <p class="mb-0 text-muted">ÁÉ≠Èó®‰∫ßÂìÅ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x mb-2 text-success"></i>
                                        <h4 id="trending-products">0</h4>
                                        <p class="mb-0 text-muted">Ë∂ãÂäø‰∫ßÂìÅ</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exclamation-triangle fa-2x mb-2 text-warning"></i>
                                        <h4 id="low-stock-products">0</h4>
                                        <p class="mb-0 text-muted">‰ΩéÂ∫ìÂ≠ò‰∫ßÂìÅ</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ‰∫ßÂìÅÊÄßËÉΩÂõæË°® -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-chart-bar me-2"></i>‰∫ßÂìÅÁ±ªÂà´ÈîÄÂîÆÂàÜÂ∏É</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="categoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-star me-2"></i>‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏É</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="ratingChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ‰∫ßÂìÅÊéíË°åË°®Ê†º -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card dashboard-card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5><i class="fas fa-trophy me-2"></i>ÁÉ≠Èó®‰∫ßÂìÅÊéíË°å</h5>
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-outline-primary btn-sm" id="sort-by-views">ÊåâÊµèËßàÈáè</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm" id="sort-by-sales">ÊåâÈîÄÈáè</button>
                                            <button type="button" class="btn btn-outline-primary btn-sm" id="sort-by-revenue">ÊåâÊî∂ÂÖ•</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="productTable">
                                                <thead>
                                                    <tr>
                                                        <th>ÊéíÂêç</th>
                                                        <th>‰∫ßÂìÅÂêçÁß∞</th>
                                                        <th>Á±ªÂà´</th>
                                                        <th>ÊµèËßàÈáè</th>
                                                        <th>Ë¥≠Áâ©ËΩ¶Ê∑ªÂä†</th>
                                                        <th>Ë¥≠‰π∞Èáè</th>
                                                        <th>ËΩ¨ÂåñÁéá</th>
                                                        <th>Êî∂ÂÖ•</th>
                                                        <th>ËØÑÂàÜ</th>
                                                        <th>Â∫ìÂ≠ò</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Âä®ÊÄÅÂä†ËΩΩ -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ‰∫ßÂìÅÊÄßËÉΩË∂ãÂäø -->
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card dashboard-card">
                                    <div class="card-header">
                                        <h5><i class="fas fa-chart-line me-2"></i>‰∫ßÂìÅÈîÄÂîÆË∂ãÂäø</h5>
                                    </div>
                                    <div class="card-body">
                        <canvas id="productTrendChart" height="200"></canvas>
                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ë∂ãÂäøÂàÜÊûê -->
                    <div id="trends" class="section" style="display: none;">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-area me-2"></i>Êï∞ÊçÆË∂ãÂäø</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Êô∫ËÉΩÂª∫ËÆÆ -->
                    <div id="recommendations" class="section" style="display: none;">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5><i class="fas fa-lightbulb me-2"></i>Êô∫ËÉΩÂª∫ËÆÆ</h5>
                            </div>
                            <div class="card-body" id="recommendationsContent">
                                <% if (report.recommendations && report.recommendations.length > 0) { %>
                                    <% report.recommendations.forEach(function(rec) { %>
                                        <div class="recommendation-item priority-<%= rec.priority %>">
                                            <h6><%= rec.title %></h6>
                                            <p class="text-muted mb-1"><%= rec.description %></p>
                                            <small class="text-info">‰ºòÂÖàÁ∫ß: <%= rec.priority %></small>
                                        </div>
                                    <% }); %>
                                <% } else { %>
                                    <p class="text-muted">ÊöÇÊó†Êô∫ËÉΩÂª∫ËÆÆ</p>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentDays = <%= days %>;
        let charts = {};
        let sortBy = 'views'; // ÈªòËÆ§ÊåâÊµèËßàÈáèÊéíÂ∫è

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            initializeCharts();
            initializeEventListeners();
            loadData();
        });

        // ÂàùÂßãÂåñÂØºËà™
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section');
            const dayButtons = document.querySelectorAll('[data-days]');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetSection = this.getAttribute('data-section');
                    
                    // Êõ¥Êñ∞ÂØºËà™Áä∂ÊÄÅ
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // ÊòæÁ§∫ÂØπÂ∫îÈÉ®ÂàÜ
                    sections.forEach(section => {
                        section.style.display = section.id === targetSection ? 'block' : 'none';
                    });
                });
            });

            dayButtons.forEach(button => {
                button.addEventListener('click', function() {
                    dayButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDays = parseInt(this.getAttribute('data-days'));
                    loadData();
                });
            });
        }

        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initializeEventListeners() {
            // ‰∫ßÂìÅÊéíÂ∫èÊåâÈíÆ
            document.getElementById('sort-by-views')?.addEventListener('click', () => {
                sortBy = 'views';
                loadProductData();
            });
            document.getElementById('sort-by-sales')?.addEventListener('click', () => {
                sortBy = 'sales';
                loadProductData();
            });
            document.getElementById('sort-by-revenue')?.addEventListener('click', () => {
                sortBy = 'revenue';
                loadProductData();
            });
        }

        // ÂàùÂßãÂåñÂõæË°®
        function initializeCharts() {
            // Ë°å‰∏∫Á±ªÂûãÂàÜÂ∏ÉÈ•ºÂõæ
            if (document.getElementById('behaviorChart')) {
                const behaviorCtx = document.getElementById('behaviorChart').getContext('2d');
                charts.behavior = new Chart(behaviorCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // ËΩ¨ÂåñÊºèÊñóÂõæ
            if (document.getElementById('conversionChart')) {
                const funnelCtx = document.getElementById('conversionChart').getContext('2d');
                charts.funnel = new Chart(funnelCtx, {
                    type: 'bar',
                    data: {
                        labels: ['ÊµèËßà', 'Âä†Ë¥≠Áâ©ËΩ¶', 'Ë¥≠‰π∞'],
                        datasets: [{
                            label: 'Áî®Êà∑Êï∞Èáè',
                            data: [],
                            backgroundColor: ['#36A2EB', '#FFCE56', '#4BC0C0']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Êî∂ÂÖ•Ë∂ãÂäøÂõæ
            if (document.getElementById('revenueChart')) {
                const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                charts.revenue = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Êî∂ÂÖ•',
                            data: [],
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏ÉÂõæ
            if (document.getElementById('hourlyActivityChart')) {
                const hourlyCtx = document.getElementById('hourlyActivityChart').getContext('2d');
                charts.hourlyActivity = new Chart(hourlyCtx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Ê¥ªË∑ÉÁî®Êà∑Êï∞',
                            data: [],
                            backgroundColor: '#17a2b8'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Áî®Êà∑ÁªÜÂàÜÂõæ
            if (document.getElementById('userSegmentChart')) {
                const segmentCtx = document.getElementById('userSegmentChart').getContext('2d');
                charts.userSegment = new Chart(segmentCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Êñ∞Áî®Êà∑', 'Ê¥ªË∑ÉÁî®Êà∑', 'Ê≤âÁù°Áî®Êà∑', 'ÊµÅÂ§±Áî®Êà∑'],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // ‰∫ßÂìÅÁ±ªÂà´ÈîÄÂîÆÂàÜÂ∏ÉÂõæ
            if (document.getElementById('categoryChart')) {
                const categoryCtx = document.getElementById('categoryChart').getContext('2d');
                charts.category = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // ‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏ÉÂõæ
            if (document.getElementById('ratingChart')) {
                const ratingCtx = document.getElementById('ratingChart').getContext('2d');
                charts.rating = new Chart(ratingCtx, {
                    type: 'bar',
                    data: {
                        labels: ['1Êòü', '2Êòü', '3Êòü', '4Êòü', '5Êòü'],
                        datasets: [{
                            label: '‰∫ßÂìÅÊï∞Èáè',
                            data: [],
                            backgroundColor: ['#dc3545', '#fd7e14', '#ffc107', '#28a745', '#20c997']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // ‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæ
            if (document.getElementById('productTrendChart')) {
                const productTrendCtx = document.getElementById('productTrendChart').getContext('2d');
                charts.productTrend = new Chart(productTrendCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: 'rgba(255, 255, 255, 0.1)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Êó•Êúü'
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ÈîÄÂîÆÈáè'
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
            }

            // Ë∂ãÂäøÂõæ
            if (document.getElementById('trendChart')) {
                const trendCtx = document.getElementById('trendChart').getContext('2d');
                charts.trend = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: 'rgba(255, 255, 255, 0.1)',
                                borderWidth: 1,
                                cornerRadius: 6,
                                displayColors: true
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Êó•Êúü',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    },
                                    maxRotation: 45
                                }
                            },
                            y: {
                                display: true,
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Êï∞Èáè',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.1)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.4
                            },
                            point: {
                                radius: 4,
                                hoverRadius: 6,
                                borderWidth: 2
                            }
                        }
                    }
                });
            }
        }

        // Âä†ËΩΩÊï∞ÊçÆ
        async function loadData() {
            console.log('ÂºÄÂßãÂä†ËΩΩÊï∞ÊçÆÔºåÂ§©Êï∞:', currentDays);
            
            try {
                // Âä†ËΩΩÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ...');
                const realtimeResponse = await fetch(`/analytics/api/realtime-overview?days=${currentDays}`);
                if (!realtimeResponse.ok) {
                    throw new Error(`ÂÆûÊó∂Ê¶ÇËßàAPIËØ∑Ê±ÇÂ§±Ë¥•: ${realtimeResponse.status} ${realtimeResponse.statusText}`);
                }
                const realtimeData = await realtimeResponse.json();
                console.log('ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ:', realtimeData);
                updateRealtimeOverview(realtimeData.data);
                console.log('‚úÖ ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

                // Âä†ËΩΩÊ¶ÇËßàÊï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩÊ¶ÇËßàÊï∞ÊçÆ...');
                const overviewResponse = await fetch(`/analytics/api/overview?days=${currentDays}`);
                if (!overviewResponse.ok) {
                    throw new Error(`Ê¶ÇËßàAPIËØ∑Ê±ÇÂ§±Ë¥•: ${overviewResponse.status} ${overviewResponse.statusText}`);
                }
                const overviewData = await overviewResponse.json();
                console.log('Ê¶ÇËßàÊï∞ÊçÆ:', overviewData);
                updateOverview(overviewData.data);
                console.log('‚úÖ Ê¶ÇËßàÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

                // Âä†ËΩΩÈ´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩÈ´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ...');
                const advancedBehaviorResponse = await fetch(`/analytics/api/advanced-user-behavior?days=${currentDays}`);
                if (!advancedBehaviorResponse.ok) {
                    throw new Error(`È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫APIËØ∑Ê±ÇÂ§±Ë¥•: ${advancedBehaviorResponse.status} ${advancedBehaviorResponse.statusText}`);
                }
                const advancedBehaviorData = await advancedBehaviorResponse.json();
                console.log('È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ:', advancedBehaviorData);
                updateAdvancedBehaviorCharts(advancedBehaviorData.data);
                console.log('‚úÖ È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

                // Âä†ËΩΩÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ...');
                const behaviorResponse = await fetch(`/analytics/api/user-behavior?days=${currentDays}`);
                if (!behaviorResponse.ok) {
                    throw new Error(`Áî®Êà∑Ë°å‰∏∫APIËØ∑Ê±ÇÂ§±Ë¥•: ${behaviorResponse.status} ${behaviorResponse.statusText}`);
                }
                const behaviorData = await behaviorResponse.json();
                console.log('Áî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ:', behaviorData);
                updateBehaviorCharts(behaviorData.data);
                console.log('‚úÖ Áî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

                // Âä†ËΩΩ‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩ‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆ...');
                await loadProductData();
                console.log('‚úÖ ‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

                // Âä†ËΩΩË∂ãÂäøÊï∞ÊçÆ
                console.log('Ê≠£Âú®Âä†ËΩΩË∂ãÂäøÊï∞ÊçÆ...');
                const trendResponse = await fetch(`/analytics/api/trends?days=${currentDays}`);
                if (!trendResponse.ok) {
                    throw new Error(`Ë∂ãÂäøAPIËØ∑Ê±ÇÂ§±Ë¥•: ${trendResponse.status} ${trendResponse.statusText}`);
                }
                const trendData = await trendResponse.json();
                console.log('Ë∂ãÂäøÊï∞ÊçÆ:', trendData);
                updateTrendChart(trendData.data);
                console.log('‚úÖ Ë∂ãÂäøÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                
                console.log('üéâ ÊâÄÊúâÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');

            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                showErrorMessage('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message);
            }
        }

        // Âä†ËΩΩ‰∫ßÂìÅÊï∞ÊçÆ
        async function loadProductData() {
            try {
                console.log('Ê≠£Âú®Âä†ËΩΩ‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆ...');
                const productResponse = await fetch(`/analytics/api/product-performance?days=${currentDays}&sortBy=${sortBy}`);
                if (!productResponse.ok) {
                    throw new Error(`‰∫ßÂìÅÊÄßËÉΩAPIËØ∑Ê±ÇÂ§±Ë¥•: ${productResponse.status} ${productResponse.statusText}`);
                }
                const productData = await productResponse.json();
                console.log('‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆ:', productData);
                
                if (!productData.data || !Array.isArray(productData.data)) {
                    throw new Error('‰∫ßÂìÅÊÄßËÉΩÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                }
                
                updateProductTable(productData.data);
                updateProductCharts(productData.data);
                return true;
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩ‰∫ßÂìÅÊï∞ÊçÆÂ§±Ë¥•:', error);
                showErrorMessage('‰∫ßÂìÅÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message);
                return false;
            }
        }

        // Êõ¥Êñ∞ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ
        function updateRealtimeOverview(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ:', data);
                if (data) {
                    // ‰ΩøÁî®Ê≠£Á°ÆÁöÑÊï∞ÊçÆÁªìÊûÑÂ≠óÊÆµ
                    const totalUsersEl = document.getElementById('total-users');
                    const dailyActiveUsersEl = document.getElementById('daily-active-users');
                    const totalOrdersEl = document.getElementById('total-orders');
                    const totalRevenueEl = document.getElementById('total-revenue');
                    const avgOrderValueEl = document.getElementById('avg-order-value');
                    const totalViewsEl = document.getElementById('total-views');
                    
                    if (totalUsersEl) totalUsersEl.textContent = data.users?.total || 0;
                    if (dailyActiveUsersEl) dailyActiveUsersEl.textContent = data.users?.daily_active || 0;
                    if (totalOrdersEl) totalOrdersEl.textContent = data.orders?.total || 0;
                    if (totalRevenueEl) totalRevenueEl.textContent = `¬•${(data.orders?.total_revenue || 0).toFixed(2)}`;
                    if (avgOrderValueEl) avgOrderValueEl.textContent = (data.orders?.avg_value || 0).toFixed(2);
                    if (totalViewsEl) totalViewsEl.textContent = data.products?.total_views || 0;
                    
                    // Â¶ÇÊûúÊúâ‰ºöËØùÊåáÊ†áÊï∞ÊçÆ
                    if (data.session_metrics) {
                        const avgSessionDurationEl = document.getElementById('avg-session-duration');
                        const bounceRateEl = document.getElementById('bounce-rate');
                        if (avgSessionDurationEl) avgSessionDurationEl.textContent = (data.session_metrics?.avg_duration || 0).toFixed(1);
                        if (bounceRateEl) bounceRateEl.textContent = `${(data.session_metrics?.bounce_rate || 0).toFixed(1)}%`;
                    }
                    
                    // Êõ¥Êñ∞Êî∂ÂÖ•Ë∂ãÂäøÂõæ
                    if (charts.revenue && data.revenue_trend && Array.isArray(data.revenue_trend)) {
                        try {
                            charts.revenue.data.labels = data.revenue_trend.map(item => item.date);
                            charts.revenue.data.datasets[0].data = data.revenue_trend.map(item => item.daily_revenue || item.revenue || item.value || 0);
                            charts.revenue.update();
                            console.log('‚úÖ Êî∂ÂÖ•Ë∂ãÂäøÂõæÊõ¥Êñ∞ÂÆåÊàêÔºåÊï∞ÊçÆÁÇπÊï∞:', data.revenue_trend.length);
                        } catch (revenueError) {
                            console.error('‚ùå Êõ¥Êñ∞Êî∂ÂÖ•Ë∂ãÂäøÂõæÂ§±Ë¥•:', revenueError);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è Êî∂ÂÖ•Ë∂ãÂäøÂõæÊï∞ÊçÆÁº∫Â§±ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ:', data.revenue_trend);
                    }
                    console.log('‚úÖ ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆÊõ¥Êñ∞ÂÆåÊàê');
                } else {
                    console.warn('‚ö†Ô∏è ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆ‰∏∫Á©∫');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆÂ§±Ë¥•:', error);
                showErrorMessage('ÂÆûÊó∂Ê¶ÇËßàÊï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•: ' + error.message);
            }
        }

        // Êõ¥Êñ∞Ê¶ÇËßàÊï∞ÊçÆ
        function updateOverview(data) {
            if (data && data.users) {
                // Ëøô‰∫õÊï∞ÊçÆÂèØËÉΩÂ∑≤ÁªèÂú®ÂÆûÊó∂Ê¶ÇËßà‰∏≠Êõ¥Êñ∞‰∫Ü
            }
        }

        // Êõ¥Êñ∞È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ
        function updateAdvancedBehaviorCharts(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ:', data);
                if (data) {
                    // Êõ¥Êñ∞‰ºöËØùÊåáÊ†á
                    if (data.session_metrics) {
                        const avgSessionDurationEl = document.getElementById('avg-session-duration');
                        const bounceRateEl = document.getElementById('bounce-rate');
                        const avgActionsPerSessionEl = document.getElementById('avg-actions-per-session');
                        
                        if (avgSessionDurationEl) avgSessionDurationEl.textContent = (data.session_metrics.avg_duration || 0) + ' ÂàÜÈíü';
                        if (bounceRateEl) bounceRateEl.textContent = `${(data.session_metrics.bounce_rate || 0)}%`;
                        if (avgActionsPerSessionEl) avgActionsPerSessionEl.textContent = (data.session_metrics.avg_actions_per_session || 0).toFixed(1);
                        console.log('‚úÖ ‰ºöËØùÊåáÊ†áÊõ¥Êñ∞ÂÆåÊàê');
                    } else {
                        console.warn('‚ö†Ô∏è ‰ºöËØùÊåáÊ†áÊï∞ÊçÆÁº∫Â§±');
                    }

                    // Êõ¥Êñ∞Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏ÉÂõæ
                    if (charts.hourlyActivity && data.hourly_activity) {
                        try {
                            const hourlyData = new Array(24).fill(0);
                            data.hourly_activity.forEach(item => {
                                const hour = parseInt(item.hour);
                                if (!isNaN(hour) && hour >= 0 && hour < 24) {
                                    hourlyData[hour] = item.actions || 0;
                                }
                            });
                            charts.hourlyActivity.data.datasets[0].data = hourlyData;
                            charts.hourlyActivity.update();
                            console.log('‚úÖ Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏ÉÂõæÊõ¥Êñ∞ÂÆåÊàê');
                        } catch (chartError) {
                            console.error('‚ùå Êõ¥Êñ∞Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏ÉÂõæÂ§±Ë¥•:', chartError);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è Áî®Êà∑Ê¥ªË∑ÉÂ∫¶Êó∂Èó¥ÂàÜÂ∏ÉÂõæÊï∞ÊçÆÊàñÂõæË°®ÂØπË±°Áº∫Â§±');
                    }

                    // Êõ¥Êñ∞ËÆæÂ§áÂàÜÂ∏ÉÂõæ
                    if (charts.userSegment && data.device_distribution) {
                        try {
                            const deviceLabels = data.device_distribution.map(item => item.device_type || 'Êú™Áü•ËÆæÂ§á');
                            const deviceData = data.device_distribution.map(item => item.users || 0);
                            charts.userSegment.data.labels = deviceLabels;
                            charts.userSegment.data.datasets[0].data = deviceData;
                            charts.userSegment.update();
                            console.log('‚úÖ ËÆæÂ§áÂàÜÂ∏ÉÂõæÊõ¥Êñ∞ÂÆåÊàê');
                        } catch (chartError) {
                            console.error('‚ùå Êõ¥Êñ∞ËÆæÂ§áÂàÜÂ∏ÉÂõæÂ§±Ë¥•:', chartError);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è ËÆæÂ§áÂàÜÂ∏ÉÂõæÊï∞ÊçÆÊàñÂõæË°®ÂØπË±°Áº∫Â§±');
                    }

                    // Êõ¥Êñ∞Áî®Êà∑Ë∑ØÂæÑÂàóË°®
                    if (data.user_paths) {
                        try {
                            updateUserPaths(data.user_paths);
                            console.log('‚úÖ Áî®Êà∑Ë∑ØÂæÑÂàóË°®Êõ¥Êñ∞ÂÆåÊàê');
                        } catch (pathError) {
                            console.error('‚ùå Êõ¥Êñ∞Áî®Êà∑Ë∑ØÂæÑÂàóË°®Â§±Ë¥•:', pathError);
                        }
                    } else {
                        console.warn('‚ö†Ô∏è Áî®Êà∑Ë∑ØÂæÑÊï∞ÊçÆÁº∫Â§±');
                    }
                    
                    console.log('‚úÖ È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÊõ¥Êñ∞ÂÆåÊàê');
                } else {
                    console.warn('‚ö†Ô∏è È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ‰∏∫Á©∫');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÂ§±Ë¥•:', error);
                showErrorMessage('È´òÁ∫ßÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•: ' + error.message);
            }
        }

        // Êõ¥Êñ∞Áî®Êà∑Ë∑ØÂæÑ
        function updateUserPaths(paths) {
            const pathsList = document.getElementById('user-paths-list');
            if (pathsList) {
                pathsList.innerHTML = '';
                
                // Â§ÑÁêÜÁî®Êà∑Ë∑ØÂæÑÊï∞ÊçÆÔºåÊåâÁî®Êà∑ÂàÜÁªÑÊòæÁ§∫ÊúÄËøëÁöÑË°å‰∏∫Â∫èÂàó
                const userGroups = {};
                paths.forEach(path => {
                    if (!userGroups[path.user_id]) {
                        userGroups[path.user_id] = [];
                    }
                    userGroups[path.user_id].push(path);
                });
                
                // ÊòæÁ§∫Ââç5‰∏™Áî®Êà∑ÁöÑË°å‰∏∫Ë∑ØÂæÑ
                Object.keys(userGroups).slice(0, 5).forEach((userId, index) => {
                    const userPaths = userGroups[userId].slice(0, 5); // ÊØè‰∏™Áî®Êà∑ÊòæÁ§∫ÊúÄÂ§ö5‰∏™Ë°å‰∏∫
                    const pathElement = document.createElement('div');
                    pathElement.className = 'mb-2 p-2 bg-dark rounded';
                    
                    const pathSequence = userPaths.map(p => p.action_type).join(' ‚Üí ');
                    pathElement.innerHTML = `
                        <small class="text-muted">Áî®Êà∑ #${userId}</small>
                        <div class="text-light">${pathSequence}</div>
                        <small class="text-info">${userPaths.length} ‰∏™Ë°å‰∏∫</small>
                    `;
                    pathsList.appendChild(pathElement);
                });
            }
        }

        // Êõ¥Êñ∞Ë°å‰∏∫ÂõæË°®
        function updateBehaviorCharts(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞Áî®Êà∑Ë°å‰∏∫ÂõæË°®ÂíåÊåáÊ†á...', data);
                
                // Êõ¥Êñ∞Áî®Êà∑Ë°å‰∏∫Ê¶ÇËßàÊåáÊ†á
                try {
                    const totalClicksEl = document.getElementById('total-clicks');
                    const cartAddsEl = document.getElementById('cart-additions');
                    const wishlistAddsEl = document.getElementById('wishlist-additions');
                    const sharesEl = document.getElementById('shares');
                    
                    // ‰ªéactionStats‰∏≠ÊèêÂèñÂêÑÁßçË°å‰∏∫ÁöÑÁªüËÆ°Êï∞ÊçÆ
                    let totalClicks = 0;
                    let cartAdditions = 0;
                    let wishlistAdditions = 0;
                    let shares = 0;
                    
                    if (data.actionStats && Array.isArray(data.actionStats)) {
                        data.actionStats.forEach(stat => {
                            const actionType = stat.action_type;
                            const count = stat.count || 0;
                            
                            // ÁªüËÆ°ÁÇπÂáªÊï∞ÔºàÂåÖÊã¨ÊµèËßà„ÄÅ‰∫ßÂìÅÊü•ÁúãÁ≠âÔºâ
                            if (actionType === 'view' || actionType === 'product_view' || actionType === 'click') {
                                totalClicks += count;
                            }
                            // ÁªüËÆ°Âä†Ë¥≠Ê¨°Êï∞
                            else if (actionType === 'add_to_cart') {
                                cartAdditions += count;
                            }
                            // ÁªüËÆ°Êî∂ËóèÊ¨°Êï∞
                            else if (actionType === 'wishlist' || actionType === 'favorite' || actionType === 'add_to_wishlist') {
                                wishlistAdditions += count;
                            }
                            // ÁªüËÆ°ÂàÜ‰∫´Ê¨°Êï∞
                            else if (actionType === 'share') {
                                shares += count;
                            }
                        });
                    }
                    
                    // Â¶ÇÊûúÊ≤°Êúâ‰ªéactionStatsËé∑ÂèñÂà∞Êï∞ÊçÆÔºåÂ∞ùËØï‰ªérawConversionDataËé∑Âèñ
                    if (totalClicks === 0 && data.rawConversionData) {
                        totalClicks = data.rawConversionData.views || 0;
                        cartAdditions = data.rawConversionData.cart_adds || 0;
                    }
                    
                    // Êõ¥Êñ∞DOMÂÖÉÁ¥†
                    if (totalClicksEl) totalClicksEl.textContent = totalClicks;
                    if (cartAddsEl) cartAddsEl.textContent = cartAdditions;
                    if (wishlistAddsEl) wishlistAddsEl.textContent = wishlistAdditions;
                    if (sharesEl) sharesEl.textContent = shares;
                    
                    console.log('‚úÖ Áî®Êà∑Ë°å‰∏∫Ê¶ÇËßàÊåáÊ†áÊõ¥Êñ∞ÂÆåÊàê:', {
                        totalClicks,
                        cartAdditions,
                        wishlistAdditions,
                        shares
                    });
                } catch (metricsError) {
                    console.error('‚ùå Êõ¥Êñ∞Áî®Êà∑Ë°å‰∏∫Ê¶ÇËßàÊåáÊ†áÂ§±Ë¥•:', metricsError);
                }
                
                // Êõ¥Êñ∞Ë°å‰∏∫ÂàÜÂ∏ÉÂõæË°®
                if (data.actionStats && charts.behavior) {
                    try {
                        charts.behavior.data.labels = data.actionStats.map(item => item.action_type);
                        charts.behavior.data.datasets[0].data = data.actionStats.map(item => item.count);
                        charts.behavior.update();
                        console.log('‚úÖ Ë°å‰∏∫ÂàÜÂ∏ÉÂõæË°®Êõ¥Êñ∞ÂÆåÊàê');
                    } catch (chartError) {
                        console.error('‚ùå Êõ¥Êñ∞Ë°å‰∏∫ÂàÜÂ∏ÉÂõæË°®Â§±Ë¥•:', chartError);
                    }
                }

                // Êõ¥Êñ∞ËΩ¨ÂåñÊºèÊñóÂõæË°®
                if (data.rawConversionData && charts.funnel) {
                    try {
                        charts.funnel.data.datasets[0].data = [
                            data.rawConversionData.views,
                            data.rawConversionData.cart_adds,
                            data.rawConversionData.purchases
                        ];
                        charts.funnel.update();
                        console.log('‚úÖ ËΩ¨ÂåñÊºèÊñóÂõæË°®Êõ¥Êñ∞ÂÆåÊàê');
                    } catch (funnelError) {
                        console.error('‚ùå Êõ¥Êñ∞ËΩ¨ÂåñÊºèÊñóÂõæË°®Â§±Ë¥•:', funnelError);
                    }
                }
                
                console.log('‚úÖ Áî®Êà∑Ë°å‰∏∫ÂõæË°®ÂíåÊåáÊ†áÊõ¥Êñ∞ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Áî®Êà∑Ë°å‰∏∫ÂõæË°®Â§±Ë¥•:', error);
                showErrorMessage('Áî®Êà∑Ë°å‰∏∫ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•: ' + error.message);
            }
        }

        // Êõ¥Êñ∞‰∫ßÂìÅË°®Ê†º
        function updateProductTable(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞‰∫ßÂìÅË°®Ê†ºÔºåÊï∞ÊçÆÈïøÂ∫¶:', data ? data.length : 0);
                const tbody = document.querySelector('#productTable tbody');
                if (!tbody) {
                    console.error('‚ùå Êâæ‰∏çÂà∞‰∫ßÂìÅË°®Ê†ºtbodyÂÖÉÁ¥†');
                    return;
                }
                
                tbody.innerHTML = '';
                
                if (!data || !Array.isArray(data)) {
                    console.warn('‚ö†Ô∏è ‰∫ßÂìÅÊï∞ÊçÆ‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                    const row = tbody.insertRow();
                    row.innerHTML = '<td colspan="10" class="text-center text-muted">ÊöÇÊó†‰∫ßÂìÅÊï∞ÊçÆ</td>';
                    return;
                }
                
                data.forEach((product, index) => {
                    try {
                        // ‰ªé‰∫ßÂìÅÂêçÁß∞Êé®Êñ≠Á±ªÂà´
                        let category = 'Êú™ÂàÜÁ±ª';
                        const name = product.name || '';
                        if (name.includes('ÊâãÊú∫')) category = 'ÊâãÊú∫';
                        else if (name.includes('ÁîµËÑë') || name.includes('Á¨îËÆ∞Êú¨')) category = 'ÁîµËÑë';
                        else if (name.includes('ËÄ≥Êú∫')) category = 'ËÄ≥Êú∫';
                        else if (name.includes('ÂÖÖÁîµÂô®')) category = 'ÂÖÖÁîµÂô®';
                        else if (name.includes('Èü≥Âìç')) category = 'Èü≥Âìç';
                        else if (name.includes('Âπ≥Êùø')) category = 'Âπ≥Êùø';
                        else if (name.includes('Êï∞ÊçÆÁ∫ø')) category = 'Êï∞ÊçÆÁ∫ø';
                        else if (name.includes('ÈîÆÁõò')) category = 'ÈîÆÁõò';
                        else if (name.includes('Èº†Ê†á')) category = 'Èº†Ê†á';
                        else if (name.includes('ÊòæÁ§∫Âô®')) category = 'ÊòæÁ§∫Âô®';
                        
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${product.name || 'Êú™Áü•‰∫ßÂìÅ'}</td>
                            <td>${product.category || category}</td>
                            <td>${product.views || 0}</td>
                            <td>${product.cart_adds || 0}</td>
                            <td>${product.purchases || 0}</td>
                            <td>${parseFloat(product.conversion_rate || 0).toFixed(2)}%</td>
                            <td>¬•${parseFloat(product.revenue || 0).toFixed(2)}</td>
                            <td>${parseFloat(product.avg_preference_score || 0).toFixed(1)}</td>
                            <td>${product.stock || 0}</td>
                        `;
                    } catch (rowError) {
                        console.error(`‚ùå ÂàõÂª∫‰∫ßÂìÅË°®Ê†ºË°åÂ§±Ë¥• (Á¥¢Âºï ${index}):`, rowError, product);
                    }
                });
                
                console.log(`‚úÖ ‰∫ßÂìÅË°®Ê†ºÊõ¥Êñ∞ÂÆåÊàêÔºåÂÖ± ${data.length} Ë°å`);
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅË°®Ê†ºÂ§±Ë¥•:', error);
                showErrorMessage('‰∫ßÂìÅË°®Ê†ºÊõ¥Êñ∞Â§±Ë¥•: ' + error.message);
            }
        }

        // Êõ¥Êñ∞‰∫ßÂìÅÂõæË°®
        function updateProductCharts(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞‰∫ßÂìÅÂõæË°®ÔºåÊï∞ÊçÆÈïøÂ∫¶:', data ? data.length : 0);
                
                if (!data || !Array.isArray(data)) {
                    console.warn('‚ö†Ô∏è ‰∫ßÂìÅÂõæË°®Êï∞ÊçÆ‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                    return;
                }
                
                // Êõ¥Êñ∞‰∫ßÂìÅÊ¶ÇËßàÊåáÊ†á
                try {
                    const totalProductsEl = document.getElementById('total-products');
                    const hotProductsEl = document.getElementById('hot-products');
                    const trendingProductsEl = document.getElementById('trending-products');
                    const lowStockProductsEl = document.getElementById('low-stock-products');
                    
                    if (totalProductsEl) totalProductsEl.textContent = data.length || 0;
                    if (hotProductsEl) hotProductsEl.textContent = data.filter(p => (p.views || 0) > 100).length || 0;
                    
                    // ‰ΩøÁî®composite_score‰Ωú‰∏∫Ë∂ãÂäøÊåáÊ†áÁöÑÊõø‰ª£
                    const trendingCount = data.filter(p => (p.composite_score || 0) > 50).length || 0;
                    if (trendingProductsEl) trendingProductsEl.textContent = trendingCount;
                    
                    if (lowStockProductsEl) lowStockProductsEl.textContent = data.filter(p => (p.stock || 0) < 10).length || 0;
                    
                    console.log('‚úÖ ‰∫ßÂìÅÊ¶ÇËßàÊåáÊ†áÊõ¥Êñ∞ÂÆåÊàê');
                } catch (metricsError) {
                    console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅÊ¶ÇËßàÊåáÊ†áÂ§±Ë¥•:', metricsError);
                }

                // Êõ¥Êñ∞‰∫ßÂìÅÁ±ªÂà´ÂàÜÂ∏ÉÂõæ
                if (charts.category) {
                    try {
                        const categoryData = {};
                        data.forEach(product => {
                            // ‰ªé‰∫ßÂìÅÂêçÁß∞Êé®Êñ≠Á±ªÂà´
                            let category = 'Êú™ÂàÜÁ±ª';
                            const name = product.name || '';
                            if (name.includes('ÊâãÊú∫')) category = 'ÊâãÊú∫';
                            else if (name.includes('ÁîµËÑë') || name.includes('Á¨îËÆ∞Êú¨')) category = 'ÁîµËÑë';
                            else if (name.includes('ËÄ≥Êú∫')) category = 'ËÄ≥Êú∫';
                            else if (name.includes('ÂÖÖÁîµÂô®')) category = 'ÂÖÖÁîµÂô®';
                            else if (name.includes('Èü≥Âìç')) category = 'Èü≥Âìç';
                            else if (name.includes('Âπ≥Êùø')) category = 'Âπ≥Êùø';
                            else if (name.includes('Êï∞ÊçÆÁ∫ø')) category = 'Êï∞ÊçÆÁ∫ø';
                            else if (name.includes('ÈîÆÁõò')) category = 'ÈîÆÁõò';
                            else if (name.includes('Èº†Ê†á')) category = 'Èº†Ê†á';
                            else if (name.includes('ÊòæÁ§∫Âô®')) category = 'ÊòæÁ§∫Âô®';
                            
                            const finalCategory = product.category || category;
                            categoryData[finalCategory] = (categoryData[finalCategory] || 0) + (product.revenue || 0);
                        });
                        
                        charts.category.data.labels = Object.keys(categoryData);
                        charts.category.data.datasets[0].data = Object.values(categoryData);
                        charts.category.update();
                        console.log('‚úÖ ‰∫ßÂìÅÁ±ªÂà´ÂàÜÂ∏ÉÂõæÊõ¥Êñ∞ÂÆåÊàê');
                    } catch (categoryError) {
                        console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅÁ±ªÂà´ÂàÜÂ∏ÉÂõæÂ§±Ë¥•:', categoryError);
                    }
                } else {
                    console.warn('‚ö†Ô∏è ‰∫ßÂìÅÁ±ªÂà´ÂàÜÂ∏ÉÂõæÂØπË±°‰∏çÂ≠òÂú®');
                }

                // Êõ¥Êñ∞‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏ÉÂõæ - ‰ΩøÁî®avg_preference_scoreÊõø‰ª£rating
                if (charts.rating) {
                    try {
                        const ratingData = [0, 0, 0, 0, 0];
                        data.forEach(product => {
                            // Â∞Üavg_preference_scoreËΩ¨Êç¢‰∏∫1-5ÁöÑËØÑÂàÜ
                            const score = product.avg_preference_score || 0;
                            const rating = Math.min(Math.max(Math.floor(score * 5), 1), 5);
                            if (rating >= 1 && rating <= 5) {
                                ratingData[rating - 1]++;
                            }
                        });
                        
                        charts.rating.data.datasets[0].data = ratingData;
                        charts.rating.update();
                        console.log('‚úÖ ‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏ÉÂõæÊõ¥Êñ∞ÂÆåÊàê');
                    } catch (ratingError) {
                        console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏ÉÂõæÂ§±Ë¥•:', ratingError);
                    }
                } else {
                    console.warn('‚ö†Ô∏è ‰∫ßÂìÅËØÑÂàÜÂàÜÂ∏ÉÂõæÂØπË±°‰∏çÂ≠òÂú®');
                }
                
                console.log('‚úÖ ‰∫ßÂìÅÂõæË°®Êõ¥Êñ∞ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅÂõæË°®Â§±Ë¥•:', error);
                showErrorMessage('‰∫ßÂìÅÂõæË°®Êõ¥Êñ∞Â§±Ë¥•: ' + error.message);
            }
        }

        // Êõ¥Êñ∞Ë∂ãÂäøÂõæË°®
        function updateTrendChart(data) {
            try {
                console.log('Ê≠£Âú®Êõ¥Êñ∞Ë∂ãÂäøÂõæË°®ÔºåÊï∞ÊçÆ:', data);
                
                // Êõ¥Êñ∞Ë∂ãÂäøÂàÜÊûêÈ°µÈù¢ÁöÑÂõæË°®
                if (charts.trend) {
                    let labels = [];
                    let datasets = [];
                    
                    // Â§ÑÁêÜÊ¥ªË∑ÉÁî®Êà∑Êï∞ÊçÆ
                    if (data.active_users && Array.isArray(data.active_users) && data.active_users.length > 0) {
                        labels = data.active_users.map(item => {
                            // Ê†ºÂºèÂåñÊó•ÊúüÊòæÁ§∫
                            const date = new Date(item.date);
                            return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                        });
                        
                        datasets.push({
                            label: 'Ê¥ªË∑ÉÁî®Êà∑',
                            data: data.active_users.map(item => item.value || 0),
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#36A2EB',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        });
                        
                        console.log('Ê¥ªË∑ÉÁî®Êà∑Êï∞ÊçÆÁÇπ:', data.active_users.map(item => item.value || 0));
                    }
                    
                    // Â§ÑÁêÜËÆ¢ÂçïÊï∞ÊçÆ
                    if (data.orders && Array.isArray(data.orders) && data.orders.length > 0) {
                        // Â¶ÇÊûúËøòÊ≤°ÊúâÊ†áÁ≠æÔºå‰ΩøÁî®ËÆ¢ÂçïÊï∞ÊçÆÁöÑÊó•Êúü
                        if (labels.length === 0) {
                            labels = data.orders.map(item => {
                                const date = new Date(item.date);
                                return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                            });
                        }
                        
                        datasets.push({
                            label: 'ËÆ¢ÂçïÊï∞',
                            data: data.orders.map(item => item.value || 0),
                            borderColor: '#FF6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#FF6384',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        });
                        
                        console.log('ËÆ¢ÂçïÊï∞ÊçÆÁÇπ:', data.orders.map(item => item.value || 0));
                    }
                    
                    // Â§ÑÁêÜÊî∂ÂÖ•Êï∞ÊçÆ
                    if (data.revenue && Array.isArray(data.revenue) && data.revenue.length > 0) {
                        // Â¶ÇÊûúËøòÊ≤°ÊúâÊ†áÁ≠æÔºå‰ΩøÁî®Êî∂ÂÖ•Êï∞ÊçÆÁöÑÊó•Êúü
                        if (labels.length === 0) {
                            labels = data.revenue.map(item => {
                                const date = new Date(item.date);
                                return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
                            });
                        }
                        
                        datasets.push({
                            label: 'Êî∂ÂÖ• (¬•)',
                            data: data.revenue.map(item => item.value || 0),
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointBackgroundColor: '#28a745',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            yAxisID: 'y1'
                        });
                        
                        // Ê∑ªÂä†Á¨¨‰∫å‰∏™YËΩ¥Áî®‰∫éÊî∂ÂÖ•
                        if (!charts.trend.options.scales.y1) {
                            charts.trend.options.scales.y1 = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Êî∂ÂÖ• (¬•)',
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(40, 167, 69, 0.1)'
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    }
                                }
                            };
                        }
                        
                        console.log('Êî∂ÂÖ•Êï∞ÊçÆÁÇπ:', data.revenue.map(item => item.value || 0));
                    }
                    
                    // Â¶ÇÊûúÊ≤°Êúâ‰ªª‰ΩïÊï∞ÊçÆÔºåÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ
                    if (labels.length === 0 || datasets.length === 0) {
                        console.log('Ê≤°ÊúâË∂ãÂäøÊï∞ÊçÆÔºåÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ');
                        const today = new Date();
                        labels = [];
                        const sampleData = [];
                        
                        for (let i = 6; i >= 0; i--) {
                            const date = new Date(today);
                            date.setDate(date.getDate() - i);
                            labels.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));
                            sampleData.push(Math.floor(Math.random() * 100) + 50);
                        }
                        
                        datasets = [{
                            label: 'Ê¥ªË∑ÉÁî®Êà∑',
                            data: sampleData,
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#36A2EB',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }];
                    }
                    
                    // Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ
                    charts.trend.data.labels = labels;
                    charts.trend.data.datasets = datasets;
                    charts.trend.update('active');
                    
                    console.log('‚úÖ Ë∂ãÂäøÂõæË°®Êõ¥Êñ∞ÂÆåÊàêÔºåÊ†áÁ≠æÊï∞:', labels.length, 'Êï∞ÊçÆÈõÜÊï∞:', datasets.length);
                }
                
                // Êõ¥Êñ∞‰∫ßÂìÅÊÄßËÉΩÈ°µÈù¢ÁöÑ‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæË°®
                if (charts.productTrend) {
                    try {
                        console.log('Ê≠£Âú®Êõ¥Êñ∞‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæË°®ÔºåÂéüÂßãÊï∞ÊçÆ:', data);
                        
                        // ‰ΩøÁî®Ë∂ãÂäøÊï∞ÊçÆÊõ¥Êñ∞‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæ
                        const labels = [];
                        const salesData = [];
                        const revenueData = [];
                        
                        // Â¶ÇÊûúÊúâËÆ¢ÂçïÊï∞ÊçÆÔºå‰ΩøÁî®ËÆ¢ÂçïÊï∞ÊçÆ‰Ωú‰∏∫ÈîÄÂîÆË∂ãÂäø
                        if (data.orders && Array.isArray(data.orders)) {
                            console.log('Â§ÑÁêÜËÆ¢ÂçïÊï∞ÊçÆ:', data.orders);
                            data.orders.forEach(item => {
                                labels.push(item.date);
                                salesData.push(item.value || 0);
                            });
                        }
                        
                        // Â¶ÇÊûúÊúâÊî∂ÂÖ•Êï∞ÊçÆÔºåÊ∑ªÂä†Êî∂ÂÖ•Ë∂ãÂäø
                        if (data.revenue && Array.isArray(data.revenue)) {
                            console.log('Â§ÑÁêÜÊî∂ÂÖ•Êï∞ÊçÆ:', data.revenue);
                            data.revenue.forEach((item, index) => {
                                if (index < labels.length) {
                                    revenueData.push(item.value || 0);
                                } else if (labels.length === 0) {
                                    labels.push(item.date);
                                    revenueData.push(item.value || 0);
                                }
                            });
                        }
                        
                        // Â¶ÇÊûúÊ≤°ÊúâÊï∞ÊçÆÔºåÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ‰ª•Á°Æ‰øùÂõæË°®ÊòæÁ§∫
                        if (labels.length === 0) {
                            console.log('Ê≤°ÊúâË∂ãÂäøÊï∞ÊçÆÔºåÂàõÂª∫Á§∫‰æãÊï∞ÊçÆ');
                            const today = new Date();
                            for (let i = 6; i >= 0; i--) {
                                const date = new Date(today);
                                date.setDate(date.getDate() - i);
                                labels.push(date.toISOString().split('T')[0]);
                                salesData.push(Math.floor(Math.random() * 50) + 10);
                                revenueData.push(Math.floor(Math.random() * 5000) + 1000);
                            }
                        }
                        
                        console.log('ÂõæË°®Ê†áÁ≠æ:', labels);
                        console.log('ÈîÄÂîÆÊï∞ÊçÆ:', salesData);
                        console.log('Êî∂ÂÖ•Êï∞ÊçÆ:', revenueData);
                        
                        // Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ
                        charts.productTrend.data.labels = labels;
                        charts.productTrend.data.datasets = [];
                        
                        if (salesData.length > 0) {
                            charts.productTrend.data.datasets.push({
                                label: 'ÈîÄÂîÆÈáè',
                                data: salesData,
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                fill: false,
                                tension: 0.4,
                                pointBackgroundColor: '#28a745',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 4
                            });
                        }
                        
                        if (revenueData.length > 0) {
                            charts.productTrend.data.datasets.push({
                                label: 'Êî∂ÂÖ•Ë∂ãÂäø (¬•)',
                                data: revenueData,
                                borderColor: '#007bff',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                fill: false,
                                tension: 0.4,
                                pointBackgroundColor: '#007bff',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 4,
                                yAxisID: 'y1'
                            });
                            
                            // Ê∑ªÂä†Á¨¨‰∫å‰∏™YËΩ¥Áî®‰∫éÊî∂ÂÖ•
                            charts.productTrend.options.scales.y1 = {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Êî∂ÂÖ• (¬•)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(0, 123, 255, 0.1)'
                                }
                            };
                        }
                        
                        charts.productTrend.update('active');
                        console.log('‚úÖ ‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæË°®Êõ¥Êñ∞ÂÆåÊàêÔºåÊï∞ÊçÆÈõÜÊï∞Èáè:', charts.productTrend.data.datasets.length);
                    } catch (productTrendError) {
                        console.error('‚ùå Êõ¥Êñ∞‰∫ßÂìÅÈîÄÂîÆË∂ãÂäøÂõæË°®Â§±Ë¥•:', productTrendError);
                    }
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Ë∂ãÂäøÂõæË°®Â§±Ë¥•:', error);
            }
        }
        
        // ÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
        function showErrorMessage(message) {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÈîôËØØÊèêÁ§∫ÂÖÉÁ¥†
            let errorElement = document.getElementById('error-message');
            
            // Â¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.id = 'error-message';
                errorElement.className = 'alert alert-danger alert-dismissible fade show';
                errorElement.style.position = 'fixed';
                errorElement.style.top = '20px';
                errorElement.style.right = '20px';
                errorElement.style.zIndex = '9999';
                errorElement.style.maxWidth = '400px';
                
                // Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ
                const closeButton = document.createElement('button');
                closeButton.type = 'button';
                closeButton.className = 'btn-close';
                closeButton.setAttribute('data-bs-dismiss', 'alert');
                closeButton.setAttribute('aria-label', 'ÂÖ≥Èó≠');
                errorElement.appendChild(closeButton);
                
                document.body.appendChild(errorElement);
            }
            
            // ËÆæÁΩÆÈîôËØØÊ∂àÊÅØÂÜÖÂÆπ
            errorElement.innerHTML = `
                <strong>ÈîôËØØ!</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="ÂÖ≥Èó≠"></button>
            `;
            
            // 5ÁßíÂêéËá™Âä®ÂÖ≥Èó≠
            setTimeout(() => {
                if (errorElement && errorElement.parentNode) {
                    errorElement.parentNode.removeChild(errorElement);
                }
            }, 5000);
        }
    </script>
</body>
</html>