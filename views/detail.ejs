<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>
    <%= product.name %> - StarShopping
  </title>
  <link rel="stylesheet" type="text/css" href="/css/style.css">
  <link rel="stylesheet" type="text/css" href="/css/detail.css">
</head>

<body>
  <div class="banner_x">
    <div class="center-content">
      <div class="logo-stack"
        style="display:flex;flex-direction:column;align-items:flex-start;gap:8px;margin-right:12px;">
        <a href="/homepage">
          <div class="logo"></div>
        </a>
        <button class="back-button" onclick="history.back()">← Back</button>
      </div>
      <a href="/products/all">
        <div class="ad_top"></div>
      </a>
    </div>

    <div class="search-cart-container">
      <div class="user-buttons">
        <a href="javascript:void(0)" id="logout-link" class="icon-button" title="Logout">
          <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
            <path fill="currentColor"
              d="M16 13v-2H7V8l-5 4 5 4v-3h9zm6-9v16c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2v-4h2v4h12V4H8v4H6V4c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2z">
            </path>
          </svg>
          <span class="label">Logout</span>
        </a>
        <a href="/profile.html" class="icon-button" title="Profile">
          <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
            <path fill="currentColor"
              d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 6a3 3 0 110 6 3 3 0 010-6zm0 8c-2.67 0-8 1.34-8 4v1h16v-1c0-2.66-5.33-4-8-4z">
            </path>
          </svg>
          <span class="label">Profile</span>
        </a>
      </div>
      <div class="cart-button">
        <a href="/cart" class="cart-link">
          <svg class="cart-icon" viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor"
              d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z">
            </path>
          </svg>
          <span class="cart-text">Cart</span>
        </a>
      </div>
      <div class="search" style="position: relative;">
        <form action="/products/all" method="get">
          <div class="text fl">
            <input type="text" name="keyword" class="shuru" placeholder="Search products">
          </div>
          <div class="submit fl">
            <input type="submit" class="sousuo" value="Search">
          </div>
          <div class="clear"></div>
        </form>
        <div class="search-results"
          style="position: absolute; top: 100%; left: 0; right: 0; background: white; border-right: 1px solid #ddd; border-bottom: 1px solid #ddd; border-left: 1px solid #ddd; border-top: none; max-height: 400px; overflow-y: auto; z-index: 10000; margin-top: 1px; box-shadow: rgba(0,0,0,0.1) 0 4px 6px; display: none;">
        </div>
        <div class="search-suggestions"
          style="position: absolute; top: calc(100% + 2px); left: 0; right: 0; background: white; border: 1px solid #e0e0e0; border-radius: 0 0 8px 8px; max-height: 300px; overflow-y: auto; z-index: 10001; box-shadow: rgba(0,0,0,0.15) 0 8px 24px; display: none; margin-top: 1px;">
        </div>
        <div class="hot-searches"
          style="position: absolute; top: calc(100% + 2px); left: 0; right: 0; background: white; border: 1px solid #e0e0e0; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 10002; box-shadow: rgba(0,0,0,0.15) 0 8px 24px; display: none; margin-top: 1px;">
        </div>
      </div>
    </div>
  </div>




  <!-- Cart Notification -->
  <div class="overlay" id="overlay"></div>
  <div class="cart-notification" id="cartNotification">
    <div class="icon">✓</div>
    <h3>Added Successfully!</h3>
    <p>Item added to cart successfully</p>
    <div class="buttons">
      <button class="btn-secondary" onclick="closeNotification()">Continue Shopping</button>
      <button class="btn-primary" onclick="window.location.href='/cart'">View Cart</button>
    </div>
  </div>

  <!-- 产品详情 -->
  <div class="product-container tb-card">
    <div class="gallery">
      <div class="main-pic">
        <!-- 数据库字段: product.image -->
        <% if (product && product.image) { %>
          <img id="mainImage" src="<%= product.image %>" alt="<%= product.name || 'Product' %>">
          <% } else { %>
            <img id="mainImage" src="/image/default.png" alt="<%= product && product.name || 'Product' %>">
            <% } %>
      </div>

    </div>
    <div class="detail-container">
      <!-- 数据库字段: product.name -->
      <h1 id="product-title">
        <%= product && product.name ? product.name : 'Unnamed Product' %>
      </h1>
      <!-- 数据库字段: product.description -->
      <div class="description" id="product-description">
        <%= (product && product.description) ? product.description : '' %>
      </div>
      <div class="tb-pricebox">
        <!-- 数据库字段: product.price -->
        <div class="tb-price" id="product-price">¥<%= (product && typeof product.price !=='undefined' ) ? product.price
            : '' %>
        </div>
        <% if (typeof product.stock !=='undefined' ) { %>
          <div class="tb-stock">
            <%= product.stock> 0 ? 'In Stock' : 'Out of Stock' %> | Stock: <%= product.stock %>
          </div>
          <% } %>
      </div>
      <div class="tb-sku">
        <div class="tb-sku-row">
          <div class="tb-sku-title">Specifications</div>
          <div class="tb-sku-options">
            <span class="tb-sku-option selected">Default</span>
          </div>
        </div>
        <!-- 可选动态块: product.shipping_html -->
        <% if (product && product.shipping_html) { %>
          <div class="ship-info" id="shipping-info"><%- product.shipping_html %></div>
          <% } %>
            <!-- 可选动态块: product.extra_info_html -->
            <% if (product && product.extra_info_html) { %>
              <div class="extra-info" id="extra-info"><%- product.extra_info_html %></div>
              <% } %>
                <div class="tb-sku-row">
                  <div class="tb-sku-title">Quantity</div>
                  <div class="tb-quantity">
                    <button class="qty-btn minus" type="button">-</button>
                    <input type="number" id="buyQty" min="1" value="1">
                    <button class="qty-btn plus" type="button">+</button>
                    <% if (typeof product.stock !=='undefined' ) { %>
                      <span class="tb-qty-stock">Stock <%= product.stock %></span>
                      <% } %>
                  </div>
                </div>
      </div>
      <div class="tb-actions">
        <button class="buy-btn" data-product-id="<%= product.id %>">Buy Now</button>
        <button class="cart-btn add-to-cart-btn" data-product-id="<%= product.id %>">Add to Cart</button>
      </div>
      <ul class="tb-service">
        <li>Genuine Guarantee</li>
        <li>7-Day Return</li>
        <li>Fast Shipping</li>
      </ul>
    </div>
  </div>

  <div class="image-tabs">
    <div class="tabs-nav">
      <div class="tab active">Reviews</div>
      <div class="tab">Specifications</div>
      <div class="tab">Details</div>
    </div>
    <div class="tab-content">
      <div class="tab-panel active">
        <!-- 数据库字段: product.reviews[] -->
        <div id="product-reviews" class="reviews-section">
          <% if (product && product.reviews && product.reviews.length) { %>
            <% product.reviews.forEach(function(rv){ %>
              <div class="review-card">
                <div class="review-avatar">
                  <img src="<%= rv.avatar || '/image/tp110.png' %>">
                </div>
                <div class="review-body">
                  <div class="review-header">
                    <span class="review-name">
                      <%= rv.author || 'Anonymous' %>
                    </span>
                    <% if (rv.rating) { %><span class="badge rating">★<%= Array(rv.rating).fill('').join('★') %></span>
                      <% } %>
                  </div>
                  <div class="review-meta">
                    <% if (rv.created_at) { %><span>
                        <%= rv.created_at %>
                      </span>
                      <% } %>
                        <% if (rv.sku_info) { %><span>Purchased: <%= rv.sku_info %></span>
                          <% } %>
                  </div>
                  <div class="review-content">
                    <%= rv.content || '' %>
                  </div>
                  <% if (rv.images && rv.images.length) { %>
                    <div class="review-images">
                      <% rv.images.forEach(function(img){ %>
                        <img src="<%= img %>">
                        <% }) %>
                    </div>
                    <% } %>
                </div>
              </div>
              <% }) %>
                <% } else { %>
                  <div class="reviews-empty">No reviews yet</div>
                  <% } %>
        </div>
      </div>
      <div class="tab-panel">
        <!-- 数据库字段: product.specs / product.specs_json -->
        <% if (product && product.specs && Object.keys(product.specs).length) { %>
          <table class="spec-table">
            <tbody>
              <% Object.keys(product.specs).forEach(function(k){ %>
                <tr>
                  <td class="title">
                    <%= k %>
                  </td>
                  <td colspan="3">
                    <%= product.specs[k] %>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
          <% } else if (product && product.specs_json) { %>
            <pre class="spec-json" id="product-specs-json"><%= product.specs_json %></pre>
            <% } else { %>
              <div class="spec-empty">No specification information</div>
              <% } %>
      </div>
      <div class="tab-panel">
        <!-- 数据库字段: product.detail_html -->
        <% if (product && product.detail_images && product.detail_images.length) { %>
          <div class="product-images">
            <% product.detail_images.forEach(function(img, idx){ %>
              <img src="<%= img %>" alt="<%= (product.name || 'Product') %> Detail Image <%= idx + 1 %>" class="detail-image"
                loading="lazy" decoding="async" onerror="this.onerror=null;this.src='/image/default.png'">
              <% }) %>
          </div>
          <% } %>
            <% if (product && product.detail_html) { %>
              <div id="product-detail-html"><%- product.detail_html %></div>
              <% } else if (!(product && product.detail_images && product.detail_images.length)) { %>
                <div class="detail-empty" style="margin-top:16px;color:#6c7a89;font-size:13px;line-height:1.8">No detailed images
                </div>
                <% } %>
                  <!-- 可选动态块: product.price_notice_html -->
                  <% if (product && product.price_notice_html) { %>
                    <div class="price-notice" id="price-notice"><%- product.price_notice_html %></div>
                    <% } %>
      </div>
    </div>
  </div>

  <!-- footer -->

  <script src="/js/detail.js"></script>
</body>

</html>
